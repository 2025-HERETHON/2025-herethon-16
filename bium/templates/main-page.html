<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy"
        content="script-src 'self' 'unsafe-eval' 'unsafe-inline';">
  <title>BIUM</title>
  <link rel="stylesheet" href="./static/css/main-page.css" />
</head>
<body>
  <!-- 사이드바 (햄버거 클릭 시 열림) -->
  <aside id="sidebar" class="sidebar">
    <img id="closeSidebar"
         src="./static/images/icons/icon-close-24.svg"
         alt="닫기 아이콘"
         class="icon-close" />
    <nav class="sidebar-menu">
      <!-- 홈 -->
      <section class="sidebar-section">
        <h3 class="section-title">홈</h3>
        <ul>
          <li><a href="./templates/main-page.html">장례 전 준비해야 할 목록</a></li>
          <li><a href="./templates/main-page.html">장례에 대한 정보들</a></li>
        </ul>
      </section>

      <!-- 추모공간 -->
      <section class="sidebar-section">
        <h3 class="section-title">추모공간</h3>
        <ul>
          <li><a href="./templates/mymemorial.html">내 추모공간</a></li>
          <li><a href="./templates/memorial-page.html">다른 사람들의 추모공간</a></li>
        </ul>
      </section>

      <!-- 디지털 유언장 -->
      <section class="sidebar-section">
        <h3 class="section-title">디지털 유언장</h3>
        <ul>
          <li><a href="./templates/will_pdf_template.html">디지털 유언장 작성</a></li>
          <li><a href="./templates/will_pdf_template.html">디지털 유언장 PDF 다운로드</a></li>
        </ul>
      </section>
    </nav>
  </aside>

  <div class="main-frame">
    <!-- 3.1 상단 바: 햄버거 · 로고 · 내 공간 -->
    <header class="main-top">
      <img id="openSidebar"
           src="./static/images/icons/icon-menu-24.svg"
           alt="메뉴 아이콘"
           class="icon-menu" />
      <div class="logo">
        <img src="./static/images/assets/logo.svg"
             alt="로고"
             class="logo" />
      </div>
      <form method="GET" action="mymemorial-edit.html" id="goMyspaceForm" style="display:inline;">
  <button type="submit" style="all:unset;">
    <img src="./static/images/icons/icon-myspace-24.svg" alt="내 공간 아이콘" class="icon-myspace" />
  </button>
</form>
      <!-- <img src="./static/images/icons/icon-myspace-24.svg"
           alt="내 공간 아이콘"
           class="icon-myspace" /> -->
    </header>

    <!-- 3.2 커버 이미지: will 단계에 따라 교체 -->
    <div class="cover-frame">
      <img
  id="coverImg"
  class="cover-img"
  src="{% if progress_step >= 10 %}
          ./static/images/assets/will-image-after.png
        {% else %}
          ./static/images/assets/will-image-before.png
        {% endif %}"
  data-completed="{% if progress_step >= 10 %}true{% else %}false{% endif %}"
  alt="커버 이미지" />

    </div>

    <!-- 3.3 서브헤더 -->
    <div class="subtitle">
      당신의 마지막 뜻을 미리 준비해두세요
    </div>

    <!-- 3.4 유언장 작성 버튼 -->
    <button class="will-btn">
      <span>유언장 작성하기</span>
      <img src="./static/images/icons/icon-arrow-right-20.svg"
           alt="오른쪽 화살표 아이콘"
           class="icon-right-arrow" />
    </button>

    <!-- 3.5 체크리스트 (폼+리다이렉트) -->
    <div class="subtitle">장례 전 준비해야 할 목록</div>
    <form id="checklistForm"
          action="/api/checklist/save/"
          method="POST"
          class="checklist-wrapper">
      {% csrf_token %}
      <div class="checklist-container">
        {% for category in checklist %}
          <div class="checklist-group" data-group="{{ forloop.counter0 }}">
            <div class="group-header">
              <div class="group-title">{{ category.name }}</div>
              <div class="group-count">0/{{ category.items|length }}</div>
            </div>
            {% for item in category.items %}
              <label class="item">
                <img class="checkbox-icon"
                     src="./static/images/icons/icon-checkbox-12=Deactivate.svg"
                     alt="체크박스 아이콘"/>
                <input type="checkbox"
                       name="item_id"
                       value="{{ item.id }}"
                       hidden/>
                <span>{{ item.content }}</span>
              </label>
            {% endfor %}
          </div>
        {% endfor %}
      </div>
      <!-- 자동 제출을 위한 숨은 버튼 -->
      <button type="submit" id="checklistSubmit" style="display:none"></button>
    </form>
  </div>

  <script src="./static/js/main-page.js"></script>
</body>
</html>
